(function(t){function r(r){for(var n,o,s=r[0],u=r[1],c=r[2],d=0,l=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&l.push(a[o][0]),a[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);p&&p(r);while(l.length)l.shift()();return i.push.apply(i,c||[]),e()}function e(){for(var t,r=0;r<i.length;r++){for(var e=i[r],n=!0,o=1;o<e.length;o++){var s=e[o];0!==a[s]&&(n=!1)}n&&(i.splice(r--,1),t=u(u.s=e[0]))}return t}var n={},o={index:0},a={index:0},i=[];function s(t){return u.p+"js/"+({common:"common",pool:"pool"}[t]||t)+"."+{common:"d5ac5be1",pool:"e1c698d8"}[t]+".js"}function u(r){if(n[r])return n[r].exports;var e=n[r]={i:r,l:!1,exports:{}};return t[r].call(e.exports,e,e.exports,u),e.l=!0,e.exports}u.e=function(t){var r=[],e={pool:1};o[t]?r.push(o[t]):0!==o[t]&&e[t]&&r.push(o[t]=new Promise((function(r,e){for(var n="css/"+({common:"common",pool:"pool"}[t]||t)+"."+{common:"31d6cfe0",pool:"1c953317"}[t]+".css",a=u.p+n,i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var c=i[s],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===n||d===a))return r()}var l=document.getElementsByTagName("style");for(s=0;s<l.length;s++){c=l[s],d=c.getAttribute("data-href");if(d===n||d===a)return r()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=r,p.onerror=function(r){var n=r&&r.target&&r.target.src||a,i=new Error("Loading CSS chunk "+t+" failed.\n("+n+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=n,delete o[t],p.parentNode.removeChild(p),e(i)},p.href=a;var f=document.getElementsByTagName("head")[0];f.appendChild(p)})).then((function(){o[t]=0})));var n=a[t];if(0!==n)if(n)r.push(n[2]);else{var i=new Promise((function(r,e){n=a[t]=[r,e]}));r.push(n[2]=i);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,u.nc&&d.setAttribute("nonce",u.nc),d.src=s(t);var l=new Error;c=function(r){d.onerror=d.onload=null,clearTimeout(p);var e=a[t];if(0!==e){if(e){var n=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",l.name="ChunkLoadError",l.type=n,l.request=o,e[1](l)}a[t]=void 0}};var p=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(r)},u.m=t,u.c=n,u.d=function(t,r,e){u.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:e})},u.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},u.t=function(t,r){if(1&r&&(t=u(t)),8&r)return t;if(4&r&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(u.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var n in t)u.d(e,n,function(r){return t[r]}.bind(null,n));return e},u.n=function(t){var r=t&&t.__esModule?function(){return t["default"]}:function(){return t};return u.d(r,"a",r),r},u.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},u.p="/lootbox-simulator/",u.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=r,c=c.slice();for(var l=0;l<c.length;l++)r(c[l]);var p=d;i.push([0,"chunk-vendors"]),e()})({0:function(t,r,e){t.exports=e("56d7")},2516:function(t,r,e){"use strict";e("4de4"),e("7db0"),e("c740"),e("d81d"),e("a434"),e("b0c0"),e("a9e3"),e("f00c"),e("d3b7"),e("25f0");var n=e("53ca");function o(t){this.groupId=void 0,this.cards=[],this.up=[],this.rate=[],Object.assign(this,t)}o.prototype.toModel=function(){return{groupId:this.groupId,cards:this.cards,rate:this.rate}};var a=o;function i(t){this.groups=[],this.cardBox=null,this.guarantee=[],this.name="untitled",this.id="",this.assign(t)}function s(t){for(var r=0,e=0;e<t.length;e++){var n=t[e];n.rate=Number(n.rate),Number.isFinite(n.rate)&&n.rate>0&&(r+=n.rate)}return r}function u(t){var r=s(t);if(0==r)return c(t);for(var e=Math.random()*r,n=0,o=0;o<t.length;o++){var a=t[o];if(n+=a.rate||0,e<n)return a}}function c(t){for(var r=t.length,e=Math.random()*r,n=0;n<t.length;n++){var o=t[n];if(e<n+1)return o}}function d(t){var r=null;if(t.up&&t.up.cards&&t.up.rate>0){var e=Math.random();r=e<t.up.rate?t.cards.filter((function(r){return t.up.cards.find((function(t){return t==r}))})):t.cards.filter((function(r){return t.up.cards.find((function(t){return t!=r}))}))}else r=t.cards.map((function(t){return t}));return r}i.prototype.choose=function(){var t=this.groups.filter((function(t){return t.cards.length>0}));if(t.length>0){var r=u(t),e=d(r),n=c(e);return n}return console.log("No avaliable card in this pool"),null},i.prototype.assign=function(t){if("object"==Object(n["a"])(t)&&(Object.assign(this,{id:t.id,name:t.name,cards:t.cards}),Array.isArray(t.groups))){this.groups.splice(0,this.groups.length);for(var r=0;r<t.groups.length;r++){var e=t.groups[r];this.addGroup(e)}}},i.prototype.addGroup=function(t){var r=new a(t),e=this;return Object.defineProperty(r,"_cardsInBox",{get:function(){return e.chooseCardsInGroup(this.groupId)}}),Object.defineProperty(r,"_groupInfo",{get:function(){var t=this;return e.cardBox&&e.cardBox.groups.find((function(r){return r.id==t.groupId}))||{}}}),this.groups.push(r),r},i.prototype.loadCardboxGroups=function(){var t=this,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.cardBox){for(var e={},n=function(r){var n=t.cardBox.groups[r];e[n.id]="";var o=t.groups.findIndex((function(t){return t.groupId==n.id}));if(o<0)t.addGroup({groupId:n.id,rate:n.rate,cards:[]});else{var a=t.groups[o];a.name=n.name,a.rate=a.rate||n.rate}},o=0;o<this.cardBox.groups.length;o++)n(o);if(r)for(var a=this.groups.length-1;a>=0;a--)void 0===e[this.groups[a].groupId]&&this.groups.splice(a,1)}else console.error("You need add cardbox before load cards")},i.prototype.chooseCardsInGroup=function(t){return this.cardBox?this.cardBox.cards.filter((function(r){return r.group==t})):[]},i.prototype.toModel=function(){var t={id:this.id,name:this.name.toString(),groups:this.groups.map((function(t){return t.toModel()}))};return t},i.prototype.removeInvalidCards=function(){for(var t=this,r=0;r<t.groups.length;r++){var e=t.groups[r];if(t.cardBox)for(var o=function(r){var n=e.cards[r];t.cardBox.cards.findIndex((function(t){return t.id==n}))<0&&e.cards.splice(r,1)},a=e.cards.length-1;a>=0;a--)o(a);if("object"==Object(n["a"])(e.up)&&Array.isArray(e.up.cards))for(var i=function(t){var r=e.up.cards[t];e.cards.findIndex((function(t){return t==r}))<0&&e.up.cards.splice(t,1)},s=e.up.cards.length-1;s>=0;s--)i(s)}};r["a"]=i},"4bc0":function(t,r,e){"use strict";e("b0c0"),e("d3b7"),e("25f0");function n(t){this.id="",this.group="",this.name="",this.photo="",Object.assign(this,t)}n.prototype.toModel=function(){return{id:this.id.toString(),group:this.group.toString(),name:this.name.toString(),photo:this.photo.toString()}},r["a"]=n},"56d7":function(t,r,e){"use strict";e.r(r);e("e260"),e("e6cf"),e("cca6"),e("a79d");var n=e("2b0e"),o=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{attrs:{id:"app"}},[e("div",{attrs:{id:"nav"}},[e("router-link",{attrs:{to:{name:"Home"}}},[t._v("主頁")]),t.gameMeta?[t._v(" |"),e("router-link",{attrs:{to:{name:"poolIndex",params:t.routerParams}}},[t._v("卡池")]),t._v("| "),e("router-link",{attrs:{to:{name:"poolConfig",params:t.routerParams}}},[t._v("設定")])]:t._e()],2),e("router-view")],1)},a=[],i={computed:{gameMeta:function(){return this.$store.state.currentGame},routerParams:function(){return{game:this.gameMeta.id}}},mounted:function(){}},s=i,u=(e("5c0b"),e("2877")),c=Object(u["a"])(s,o,a,!1,null,null,null),d=c.exports,l=(e("7db0"),e("53ca")),p=e("2f62");e("c740"),e("4160"),e("d81d"),e("a434"),e("159b"),e("b0c0");function f(t){this.id="",this.name="",this.color="#AAAAAA",this.rate=0,Object.assign(this,t)}f.prototype.toModel=function(){return{id:this.id,name:this.name,color:this.color,rate:this.rate}};var h=f,m=e("4bc0"),g=e("2516");e("d3b7"),e("25f0");function v(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;e<1&&(e=1);for(var n="",o=0,a=0;a<100;a++){var i=e+Math.round(o/10);if(n=t+Math.random().toString(36).substr(2,i),!Array.isArray(r)||r.findIndex((function(t){return t==n}))<0)break}return n}function b(){this.cards=[],this.groups=[],this.pools=[],this.defaultGroup=b.defaultGroup;var t=this;this.addCard=function(r){if(r){if(r.id||(r.id=v("card_",this.cards.map((function(t){return t.id})))),!this.getCard(r.id)){var e=e instanceof m["a"]?r:new m["a"](r),n=this.defaultGroup;return Object.defineProperty(e,"_group",{get:function(){var r=this;return t.groups.find((function(t){return t.id==r.group}))||n}}),this.cards.push(e),r}console.error("Card "+r.id+" is already existed, the new card will not be put inside box.")}},this.addCards=function(t){for(var r=[],e=0;e<t.length;e++){var n=t[e],o=this.addCard(n);o&&r.push(o)}return r},this.removeCard=function(t){this.cards.splice(this.cards.findIndex((function(r){return r.id==t})),1)},this.getCard=function(t){return this.cards.find((function(r){return r.id==t}))},this.getGroup=function(t){return this.groups.find((function(r){return r.id==t}))},this.addGroup=function(t){var r=new h(t);return this.groups.push(r),r},this.addGroups=function(t){for(var r=0;r<t.length;r++){var e=t[r];this.addGroup(e)}},this.removeGroup=function(t){this.groups.splice(this.groups.findIndex(t),1)},this.addPool=function(t){var r=new g["a"](t);r.cardBox=this,r.loadCardboxGroups(),this.pools.push(r)},this.addPools=function(r){r.forEach((function(r){return t.addPool(r)}))},this.removePool=function(t){this.pools.splice(this.pools.findIndex(t),1)},this.setModel=function(t){this.pools.splice(0,this.pools.length),this.cards.splice(0,this.cards.length),this.groups.splice(0,this.groups.length),Array.isArray(t.groups)&&this.addGroups(t.groups),Array.isArray(t.cards)&&this.addCards(t.cards),Array.isArray(t.pools)&&this.addPools(t.pools)}}b.prototype.toModel=function(){return{cards:this.cards.map((function(t){return t.toModel()})),groups:this.groups.map((function(t){return t.toModel()})),pools:this.pools.map((function(t){return t.toModel()}))}},b.prototype.clear=function(){this.cards.clear(),this.groups.clear(),this.pools.clear()},b.createDefaultCard=function(t){var r=new m["a"](t);return Object.defineProperty(r,"_group",{get:function(){return b.defaultGroup}}),r},b.defaultGroup=new h({id:"Default",color:"#AAAAAA",name:"未定義"});var y=b,x=(e("ac1f"),e("5319"),e("bc3a").default),G="https://expzen.github.io/statics/lootbox/";function j(){return x.get(_("~/index.json"))}function A(t){return x.get(_(t))}function _(t){return"string"==typeof t?t.replace(/^~\//,G):""}var w={fetchMeta:j,fetchGame:A};n["a"].use(p["a"]);var M="datastore_pool_",C="datastore_index",O=new y,I={meta:null,localMeta:null,cardBox:O,currentGame:{id:"custom",name:"自訂義",error:{isError:!1}}},S={id:"custom",name:"自訂義",error:{isError:!1}},B=new p["a"].Store({state:I,mutations:{setCurrentGame:function(t,r){"object"!=Object(l["a"])(t.currentGame)&&(t.currentGame=S),t.currentGame=r},saveGame:function(t){"object"!=Object(l["a"])(t.currentGame)&&(t.currentGame=S);var r=t.cardBox.toModel(),e=JSON.stringify(r),n=t.currentGame;window.localStorage.setItem(M+n.id,e)},loadGame:function(t,r){t.cardBox.clear(),t.cardBox.setModel(r)},loadMeta:function(t,r){t.meta=r},loadLocalMeta:function(t){var r=window.localStorage.getItem(C),e=JSON.parse(r);t.localMeta.games=e},setGameError:function(t,r){r&&(t.isError=r.isError||!1,t.message=r.message||[],t.exception=r.exception||null)}},actions:{loadGame:function(t,r){var e=t.getters.games.find((function(t){return t.id==r.id}));if(r.loadCustom||!e){var n=window.localStorage.getItem(M+r.id);if(n){var o=JSON.parse(n);return t.commit("loadGame",o),o}}if(e){if(t.commit("setCurrentGame",e),"object"==Object(l["a"])(e.data)){var a=e.data;return t.commit("loadGame",a),a}if("string"==typeof e.data)return w.fetchGame(e.data).then((function(r){var e=r.data;return t.commit("loadGame",e),e})).catch((function(r){console.log("獎池載入錯誤",r),t.commit("loadGame",{}),t.commit("setGameError",{isError:!0,message:["無法載入指定資料"],exception:r})}))}t.gameId=r},saveGame:function(t){return t.commit("saveGame"),t.currentGame},loadMeta:function(t){return w.fetchMeta().then((function(r){var e=r.data;return t.commit("loadMeta",e),e}))}},getters:{pools:function(t){return t.cardBox.pools},cards:function(t){return t.cardBox.cards},cardGroups:function(t){return t.cardBox.groups},games:function(t){return t.meta?t.meta.games:[]},meta:function(t){return t.meta},currentGame:function(t){return t.currentGame}}}),E=e("8c4f"),P=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"page home"},[e("div",{staticClass:"page-title"},[t._v(" 抽卡模擬器 ")]),e("menu-panel",{attrs:{items:t.games,title:"遊戲"},on:{select:t.chooseGame}})],1)},k=[],N=e("c179"),T={name:"Home",components:{"menu-panel":N["a"]},data:function(){return{}},methods:{chooseGame:function(t){this.$router.push({name:"poolIndex",params:{game:t.id}})}},computed:{games:function(){return this.$store.getters.games}}},$=T,L=Object(u["a"])($,P,k,!1,null,null,null),J=L.exports;n["a"].use(E["a"]);var D=[{path:"/",name:"Home",component:J},{path:"/:game/pool",name:"poolIndex",component:function(){return e.e("pool").then(e.bind(null,"1a63"))}},{path:"/:game/pool/:id",name:"pool",component:function(){return e.e("pool").then(e.bind(null,"1011"))}},{path:"/:game/config",name:"poolConfig",component:function(){return e.e("pool").then(e.bind(null,"09ee"))}},{path:"*",component:function(){return e.e("common").then(e.bind(null,"9703"))}}],H=new E["a"]({mode:"history",base:"/lootbox-simulator/",routes:D});H.beforeEach((function(t,r,e){B||e();var n=t.params.game;null!=B.getters.meta&&"object"==Object(l["a"])(B.getters.meta)?null!=B.getters.currentGame&&B.getters.currentGame.id==n?e():B.dispatch("loadGame",{id:n}).then((function(){e()})):B.dispatch("loadMeta").then((function(){B.dispatch("loadGame",{id:n}).then((function(){e()}))}))}));var q=H;e("a312");n["a"].config.productionTip=!1,new n["a"]({store:B,router:q,render:function(t){return t(d)}}).$mount("#app")},"5c0b":function(t,r,e){"use strict";var n=e("9c0c"),o=e.n(n);o.a},"737b":function(t,r,e){},"828c":function(t,r,e){"use strict";var n=e("737b"),o=e.n(n);o.a},"9c0c":function(t,r,e){},a312:function(t,r,e){e("4160"),e("a434"),e("159b"),Array.prototype.apply=function(t){var r=this;Array.isArray(t)&&(this.splice(0,this.length),t.forEach((function(t){return r.push(t)})))},Array.prototype.clear=function(){this.splice(0,this.length)}},c179:function(t,r,e){"use strict";var n=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"menu-panel"},[e("div",{staticClass:"menu-header"},[t._v(t._s(t.title))]),e("div",{staticClass:"menu-body"},t._l(t.items,(function(r){return e("div",{key:r.id,staticClass:"menu-item",on:{click:function(e){return t.clickItem(r)}}},[t._v(t._s(r.name))])})),0)])},o=[],a={props:{items:{type:Array},title:{type:String}},methods:{clickItem:function(t){this.$emit("select",t)}}},i=a,s=(e("828c"),e("2877")),u=Object(s["a"])(i,n,o,!1,null,null,null);r["a"]=u.exports}});
//# sourceMappingURL=index.654a4291.js.map