(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pool"],{"072e":function(t,e,a){"use strict";var i=a("d9de"),s=a.n(i);s.a},"09ee":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"panel"},[a("div",{staticClass:"panel-header"},[t._v("卡池")]),a("div",{staticClass:"panel-body"},[a("card-pool")],1)]),a("div",{staticClass:"panel"},[a("div",{staticClass:"panel-header"},[t._v("卡片")]),a("div",{staticClass:"panel-body"},[a("card-box",{attrs:{cards:t.cardList}})],1)]),a("div",{staticClass:"panel"},[a("div",{staticClass:"panel-header"},[t._v("群組")]),a("div",{staticClass:"panel-body"},[a("div",{staticClass:"section"},[a("card-group")],1)])]),a("div",{staticClass:"panel"},[a("div",{staticClass:"panel-body"},[a("button",{staticClass:"btn",on:{click:t.saveGame}},[t._v("儲存")]),a("button",{staticClass:"btn",on:{click:function(e){return t.loadGame(!0)}}},[t._v("載入自訂")]),a("button",{staticClass:"btn",on:{click:function(e){return t.loadGame(!1)}}},[t._v("載入預設")])])])])},s=[],r=a("5530"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"config-cardbox row"},[a("card-edit-form",{staticClass:"cardbox-form col w-lg-25 block",attrs:{action:t.formStatus},on:{cancel:t.abortEdit,create:t.create,edit:t.update,showCreate:t.add},model:{value:t.currentCard,callback:function(e){t.currentCard=e},expression:"currentCard"}}),a("div",{staticClass:"cardbox-list col w-lg-75"},t._l(t.cardList,(function(e){return a("card-wrapper",{key:e.id,attrs:{active:t.targetCard==e}},[a("card",{attrs:{value:e},nativeOn:{click:function(a){return t.edit(e)}}})],1)})),1)],1)},o=[],c=a("2a43"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"side-form card-from row"},["edit"==t.action||"create"==t.action?[a("div",{staticClass:"form-header"},[a("h2",[t._v(t._s(t.title))])]),a("div",{staticClass:"form-body"},[a("div",{staticClass:"img-wrapper gamecard-img"},[a("img",{attrs:{src:t.image,alt:""}})]),a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("編號")]),a("div",{staticClass:"col w-75"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.id,expression:"id"}],staticClass:"w-100 form-control",attrs:{type:"text"},domProps:{value:t.id},on:{input:function(e){e.target.composing||(t.id=e.target.value)}}}),a("invalid-message",{attrs:{value:t.validation.id}})],1)]),a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("名稱")]),a("div",{staticClass:"col w-75"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"w-100 form-control",attrs:{type:"text"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}}),a("invalid-message",{attrs:{value:t.validation.name}})],1)]),a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("群組")]),a("div",{staticClass:"col w-75"},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.group,expression:"group"}],staticClass:"w-100 form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.group=e.target.multiple?a:a[0]}}},t._l(t.cardGroups,(function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])})),0),a("invalid-message",{attrs:{value:t.validation.group}})],1)]),a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("圖片")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.image,expression:"image"}],staticClass:"form-control w-75",attrs:{type:"text"},domProps:{value:t.image},on:{input:function(e){e.target.composing||(t.image=e.target.value)}}})]),a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("常駐")]),a("div",{staticClass:"col w-75"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.resident,expression:"resident"}],staticClass:"w-100 form-control",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.resident)?t._i(t.resident,null)>-1:t.resident},on:{change:function(e){var a=t.resident,i=e.target,s=!!i.checked;if(Array.isArray(a)){var r=null,n=t._i(a,r);i.checked?n<0&&(t.resident=a.concat([r])):n>-1&&(t.resident=a.slice(0,n).concat(a.slice(n+1)))}else t.resident=s}}})])])]),a("div",{staticClass:"form-footer"},[a("button",{staticClass:"btn btn-primary",on:{click:t.commit}},[t._v("確定")]),a("button",{staticClass:"btn",on:{click:t.cancel}},[t._v("取消")]),a("button",{staticClass:"btn btn-danger",on:{click:t.remove}},[t._v("刪除")])])]:[a("div",{staticClass:"form-body"},[a("button",{staticClass:"btn",on:{click:t.create}},[t._v("新增")])])]],2)},u=[],d=(a("4de4"),a("7db0"),a("d81d"),a("b0c0"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.show?a("div",{staticClass:"invalid-message"},t._l(t.messages,(function(e,i){return a("div",{key:i},[t._v(" "+t._s(e)+" ")])})),0):t._e()}),v=[],p={props:{value:{type:Object}},computed:{messages:function(){return this.value.result.messages},show:function(){var t=this.value.result;return t.invalid&&t.messages&&t.messages.length>0}}},f=p,g=(a("6d5c"),a("2877")),m=Object(g["a"])(f,d,v,!1,null,null,null),h=m.exports,b=a("53ca"),C=(a("a434"),a("ac1f"),a("5319"),a("ade3"));a("c740"),a("a9e3"),a("4d63"),a("25f0");function w(t){return null!==t&&""!==t&&void 0!==t}function y(t,e){return!("string"!==typeof t&&!Array.isArray(t))&&t.length<=e}function _(t,e){return!("string"!==typeof t&&!Array.isArray(t))&&t.length>=e}function x(t,e){var a=Number(t),i=Number(e);return a<=i}function O(t,e){var a=Number(t),i=Number(e);return a>=i}function k(t,e){return!!Array.isArray(e)&&e.findIndex((function(e){return e==t}))>=0}function j(t,e){return!Array.isArray(e)||e.findIndex((function(e){return e==t}))<0}function $(t,e){return"string"==typeof e&&(e=RegExp(e)),e instanceof RegExp?e.test(t):(console.error("Regular expression error, validator value is not a RegExp object or pattern string"),!1)}var P={required:w,maxlen:y,minlen:_,within:k,max:x,min:O,without:j,regex:$},G={required:"必填欄位",maxlen:"不應長於 %v",minlen:"不應短於 %v",max:"應不大於 %v",min:"應不小於 %v",within:"該值不在可用範圍內",without:"該值不可在指定範圍內",default:"未通過 %k 驗證"},A=G;function E(t,e,a){this.model=t,this.key=a,this.result={invalid:!1,messages:[],validators:{}},Object.assign(this.model,{result:this.result});var i=this;Object.defineProperty(i,"data",{configurable:!0,get:function(){switch(Object(b["a"])(e)){case"object":return e[a];case"function":return e()[a];default:return""}},set:function(t){switch(Object(b["a"])(e)){case"object":e[a]=t,this.validate();break;case"function":e()[a]=t,this.validate();break}}})}function S(t){var e=t.msg;if("string"!=typeof e&&(e=A[t.key]),"string"==typeof e)return e.replace(/%v/g,t.value).replace(/%k/g,t.key).replace(/%d/g,t.data)}E.prototype.validate=function(){var t=!0,e=this;for(var a in this.clearMessage(),e.model.rules){var i=e.model.rules[a],s=!0,r="function"==typeof i.value?i.value():i.value,n=e.data;if(P[a]&&(s=P[a](n,r),t=t&&s),"object"!=Object(b["a"])(e.result[a])&&Object.assign(e.result.validators,Object(C["a"])({},a,{invalid:!1})),s)e.result.validators[a].invalid=!1;else{var o=S({key:a,value:r,msg:i.message,data:n||""});e.result.messages.push(o),e.result.validators[a].invalid=!0}}return this.result.invalid=!t,t},E.prototype.clearMessage=function(){this.result.messages.splice(0,this.result.messages.length)},E.prototype.dispose=function(){delete this.model,delete this.key,delete this.data};var I=E;function B(t,e){this.targets={},this.data=null,this.validation={},this.bind(t,e),Object.defineProperty(this,"invalid",{get:function(){for(var t in this.targets)if(Object.hasOwnProperty.call(this.targets,t)){var e=this.targets[t];if(e.invalid)return!0}return!1}})}B.prototype.bind=function(t,e){if("object"==Object(b["a"])(t)||"function"==typeof t)switch(Object(b["a"])(t)){case"object":this.data=function(){return t};break;case"function":this.data=t;break}else if(void 0==this.data)return;if("object"==Object(b["a"])(e)&&(this.validation=e),"object"==Object(b["a"])(this.validation))for(var a in this.unbind(),this.validation)if(Object.hasOwnProperty.call(this.validation,a)&&"$"!=a[0]){var i=this.validation[a];this.targets[a]=new I(i,this.data,a)}},B.prototype.unbind=function(){for(var t in this.targets)Object.hasOwnProperty.call(this.targets,t)&&"$"!=t[0]&&("function"==typeof this.targets[t].dispose&&this.targets[t].dispose(),delete this.targets[t])},B.prototype.validate=function(){var t=!1;for(var e in this.targets){var a=this.targets[e];if(a instanceof I){var i=a.validate();t=t||!i}}return this.validation.$invalid=t,!t},B.prototype.cleanMessage=function(){for(var t in this.targets){var e=this.targets[t];e instanceof I&&e.cleanMessage()}},B.validationMessages=A;var N=a("2f62"),D={components:{"invalid-message":h},props:{value:{type:Object}},data:function(){var t=this,e=new B,a={name:{rules:{required:{}}},id:{rules:{required:{},without:{value:function(){return t.$store.getters.cards.map((function(t){return t.id})).filter((function(e){return e!=t.value.id}))},message:"該ID已經被占用"}}},group:{rules:{required:{},within:{value:function(){return t.$store.getters.cardGroups.map((function(t){return t.id}))},message:"請選擇一個群組"}}}},i={id:"",name:"",group:"",image:"",action:"",resident:!1,validation:a,validator:e};return e.bind((function(){return i}),i.validation),i},computed:Object(r["a"])({title:function(){switch(this.action){case"create":return"新增";case"edit":return"變更"}return""},cardGroups:function(){return this.$store.getters.cardGroups}},Object(N["b"])(["cardGroups","cards"])),methods:{commit:function(){var t=this.validator.validate();if(t){var e={id:this.id,name:this.name,group:this.group,image:this.image,resident:this.resident};"create"==this.action?this.$store.state.cardBox.addCard(e):"edit"==this.action?(Object.assign(this.target,e),this.target=null):this.$emit("commit",this.value),this.action="",this.clean()}},cancel:function(){this.target=null,this.clean(),this.action="",this.$emit("cancel")},create:function(){this.$emit("input",""),this.clean(),this.target=null,this.action="create"},clean:function(){this.name="",this.group="",this.id="",this.image="",this.resident=!1,this.$emit("input",{})},remove:function(){this.$store.state.cardBox.removeCard(this.id),this.clean(),this.action=""}},watch:{value:function(t){if(this.target=this.cards.find((function(e){return e.id==t.id})),this.target){var e=this.target.toModel();this.id=e.id,this.name=e.name,this.group=e.group,this.image=e.image,this.resident=e.resident,this.action="edit"}}}},R=D,T=(a("f81e"),Object(g["a"])(R,l,u,!1,null,null,null)),M=T.exports,q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-wrapper",class:{active:t.active}},[t._t("default")],2)},L=[],U={props:{active:{type:Boolean,default:!1}}},H=U,F=(a("3920"),Object(g["a"])(H,q,L,!1,null,null,null)),J=F.exports,X=a("4bc0"),Y={props:{cards:{type:Array}},components:{card:c["a"],"card-edit-form":M,"card-wrapper":J},data:function(){var t=this.$store.state.groups;return{nextId:0,currentCard:null,targetCard:null,showEditModal:!1,cardGroups:t,formStatus:""}},computed:{cardList:function(){return this.$store.state.cardBox.cards}},methods:{add:function(){console.log("add"),this.currentCard=new X["a"],this.targetCard={},this.formStatus="create"},edit:function(t){this.currentCard=Object.assign({},t),this.targetCard=t,this.showEditModal=!0,this.formStatus="edit"},update:function(){Object.assign(this.targetCard,this.currentCard),this.deactiveEdit()},create:function(t){this.$store.commit("addCard",t),this.nextId++,this.deactiveEdit()},abortEdit:function(){this.deactiveEdit()},deactiveEdit:function(){this.formStatus="none",this.currentCard={},this.targetCard=null}},mounted:function(){}},z=Y,K=(a("fb84"),Object(g["a"])(z,n,o,!1,null,null,null)),Q=K.exports,V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"config-cardgroup"},[a("div",{},[a("div",{staticClass:"table cardgroup-table"},[t._m(0),a("div",{staticClass:"table-body"},[t._l(t.groups,(function(e){return a("cardgroup-row",{key:e.id,attrs:{value:e,mode:"edit"},on:{remove:t.remove}})})),t.isCreating?a("cardgroup-row",{attrs:{value:t.editingGroup,status:{mode:"edit"}},on:{commit:t.onCreate,cancel:t.onCreateCancel}}):a("div",{staticClass:"row"},[a("div",{staticClass:"table-col"},[a("button",{staticClass:"btn",on:{click:t.add}},[t._v("新增")])])])],2)])])])},W=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table-header"},[a("span",{staticClass:"table-col c-id"},[t._v("編號")]),a("span",{staticClass:"table-col c-name"},[t._v("名稱")]),a("span",{staticClass:"table-col c-rate"},[t._v("預設機率")]),a("span",{staticClass:"table-col c-color"},[t._v("顏色")]),a("span",{staticClass:"table-col c-button"})])}],Z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table-row cardgroup"},["edit"==t.status.mode?[a("div",{staticClass:"table-col c-id"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.editingGroup.id,expression:"editingGroup.id"}],staticClass:"w-100 form-control",attrs:{type:"text"},domProps:{value:t.editingGroup.id},on:{input:function(e){e.target.composing||t.$set(t.editingGroup,"id",e.target.value)}}}),a("invalid-message",{staticClass:"w-100",attrs:{value:t.validation.id}})],1),a("div",{staticClass:"table-col c-name"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.editingGroup.name,expression:"editingGroup.name"}],staticClass:"row w-100 form-control",attrs:{type:"text"},domProps:{value:t.editingGroup.name},on:{input:function(e){e.target.composing||t.$set(t.editingGroup,"name",e.target.value)}}}),a("invalid-message",{staticClass:"w-100",attrs:{value:t.validation.name}})],1),a("div",{staticClass:"table-col c-rate"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.editingGroup.rate,expression:"editingGroup.rate"}],staticClass:"row w-100 form-control",attrs:{type:"text"},domProps:{value:t.editingGroup.rate},on:{input:function(e){e.target.composing||t.$set(t.editingGroup,"rate",e.target.value)}}}),a("invalid-message",{staticClass:"w-100",attrs:{value:t.validation.rate}})],1),a("div",{staticClass:"table-col c-color"},[a("div",{staticClass:"row w-100"},[a("div",{staticClass:"col w-20",style:{background:t.editingGroup.color}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.editingGroup.color,expression:"editingGroup.color"}],staticClass:"form-control col w-80",attrs:{type:"text"},domProps:{value:t.editingGroup.color},on:{input:function(e){e.target.composing||t.$set(t.editingGroup,"color",e.target.value)}}})]),a("invalid-message",{staticClass:"w-100",attrs:{value:t.validation.color}})],1),a("div",{staticClass:"table-col c-button"},[a("button",{staticClass:"btn",on:{click:function(e){return t.commit()}}},[t._v("確認")]),a("button",{staticClass:"btn",on:{click:function(e){return t.cancel()}}},[t._v("取消")])])]:[a("div",{staticClass:"table-col c-id"},[t._v(" "+t._s(t.value.id)+" ")]),a("div",{staticClass:"table-col c-name"},[t._v(" "+t._s(t.value.name)+" ")]),a("div",{staticClass:"table-col c-rate"},[t._v(t._s(t.value.rate)+" ")]),a("div",{staticClass:"table-col c-color"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col w-20",style:{background:t.value.color}}),a("div",{staticClass:"col w-80"},[t._v(t._s(t.value.color))])])]),a("div",{staticClass:"table-col c-button"},[a("button",{staticClass:"btn",on:{click:function(e){return t.edit()}}},[t._v("編輯")]),a("button",{staticClass:"btn",on:{click:function(e){return t.remove()}}},[t._v("刪除")])])]],2)},tt=[],et={components:{"invalid-message":h},props:{value:{type:Object},status:{type:Object,default:function(){return{mode:"view"}}}},data:function(){this.$validator=new B;var t=this,e={editingGroup:{},validation:{id:{rules:{required:{},without:{value:function(){return t.$store.getters.cardGroups.map((function(t){return t.id})).filter((function(e){return e!=t.value.id}))},message:"該ID已經被占用"}}},name:{rules:{required:{}}},rate:{rules:{max:{value:1},min:{value:0}}},color:{rules:{regex:{value:/^#([0-9A-Fa-f]{3,3})([0-9A-Fa-f]{3,3})?$/,message:"不是顏色的格式"}}}}};return this.$validator.bind((function(){return t.editingGroup}),e.validation),e},methods:{edit:function(){this.editingGroup=Object.assign({},this.value),this.status.mode="edit",this.$emit("startEdit",this.value)},finishEdit:function(){this.editingGroup=null,this.status.mode="view"},remove:function(){this.$emit("remove",this.value)},cancel:function(){this.finishEdit(),this.$emit("cancel",this.value)},commit:function(){var t=this.$validator.validate();console.log(t),t&&(this.editingGroup?(Object.assign(this.value,this.editingGroup),this.$emit("commit",this.editingGroup)):console.error("Group is not existed"),this.finishEdit())}},watch:{status:function(t){"edit"==t.mode?this.edit():this.finishEdit()}}},at=et,it=(a("daaa"),Object(g["a"])(at,Z,tt,!1,null,null,null)),st=it.exports,rt={components:{"cardgroup-row":st},data:function(){return{targetGroup:{},editingGroup:null,isCreating:!1}},methods:{add:function(){this.editingGroup={},this.isCreating=!0},remove:function(t){var e=this.groups.findIndex((function(e){return e==t}));(0===e||e>0)&&this.groups.splice(e,1)},onCreate:function(t){this.$store.state.cardBox.addGroup(t),this.editingGroup=null,this.isCreating=!1},onCreateCancel:function(){this.isCreating=!1,this.editingGroup=null}},computed:{groups:function(){return this.$store.state.cardBox?this.$store.state.cardBox.groups:[]}}},nt=rt,ot=(a("c67e"),Object(g["a"])(nt,V,W,!1,null,null,null)),ct=ot.exports,lt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"config-pool row"},[a("div",{staticClass:"col w-25 pool-list"},[a("div",{staticClass:"row block"},[a("button",{staticClass:"btn",on:{click:t.create}},[t._v("新增")])]),t._l(t.pools,(function(e){return a("div",{key:e.index,staticClass:"row block",on:{click:function(a){return t.open(e)}}},[t._v(t._s(e.name))])}))],2),a("div",{staticClass:"col w-75 pool-content"},[t.currentPool?a("div",{staticClass:"row"},[a("div",{staticClass:"col w-100"},[a("div",{staticClass:"block"},[a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("編號")]),a("div",{staticClass:"col w-75"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.currentPool.id,expression:"currentPool.id"}],staticClass:"form-control w-100",attrs:{type:"text"},domProps:{value:t.currentPool.id},on:{input:function(e){e.target.composing||t.$set(t.currentPool,"id",e.target.value)}}}),a("invalid-message",{staticClass:"w-100",attrs:{value:t.validation.id}})],1)]),a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("名稱")]),a("div",{staticClass:"w-75"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.currentPool.name,expression:"currentPool.name"}],staticClass:"form-control w-100",attrs:{type:"text"},domProps:{value:t.currentPool.name},on:{input:function(e){e.target.composing||t.$set(t.currentPool,"name",e.target.value)}}}),a("invalid-message",{staticClass:"w-100",attrs:{value:t.validation.name}})],1)]),a("div",{staticClass:"control-group"},[a("button",{staticClass:"btn btn-primary",on:{click:t.commit}},[t._v("儲存")]),a("button",{staticClass:"btn",on:{click:t.cancel}},[t._v("取消")]),a("button",{staticClass:"btn btn-danger",on:{click:t.remove}},[t._v("刪除")])])])]),a("div",{staticClass:"col w-100"},t._l(t.currentPool.groups,(function(e){return a("div",{key:e.id,staticClass:"row col pool-group block"},[a("div",{staticClass:"row text-left title"},[t._v(" "+t._s(e._groupInfo.name)+" "),e._isUnexistedGroup?a("span",{staticClass:"t-error"},[t._v("無效的群組")]):t._e()]),a("div",{staticClass:"row w-100"},[a("div",{staticClass:"col w-lg-33"},[a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("群組機率")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.rate,expression:"group.rate"}],staticClass:"form-control w-75",attrs:{type:"decimal"},domProps:{value:e.rate},on:{input:function(a){a.target.composing||t.$set(e,"rate",a.target.value)}}})]),a("div",{staticClass:"control-group row"},[a("div",{staticClass:"col w-25"},[t._v("UP機率")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.upRate,expression:"group.upRate"}],staticClass:"form-control w-50",attrs:{type:"decimal"},domProps:{value:e.upRate},on:{input:function(a){a.target.composing||t.$set(e,"upRate",a.target.value)}}}),a("button",{staticClass:"col w-25 btn",class:{active:"up"==t.cardSelectType},on:{click:t.toggleUpSelectMode}},[t._v("指定UP")])]),a("div",{staticClass:"control-group row"},[a("button",{staticClass:"btn",on:{click:function(a){return t.toggleAllCardInGroup(e,1)}}},[t._v("全選")]),a("button",{staticClass:"btn",on:{click:function(a){return t.toggleAllCardInGroup(e,0)}}},[t._v("全不選")])])]),a("div",{staticClass:"col w-lg-66"},t._l(t.getCardsOfGroup(e),(function(i,s){return a("card",{key:s,staticClass:"gamecard-min",attrs:{selected:i.selected,up:i.up,card:i},nativeOn:{mouseenter:function(a){return t.toggleCard(s,e)},mousedown:function(a){return t.startToggleCard(s,e)}}})})),1)])])})),0)]):t._e()])])},ut=[],dt=(a("4160"),a("159b"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:{"gamecard-up":t.up},style:t.cssStyle},[a("div",{staticClass:"gamecard-title"},[t._v(t._s(t.card.name))])])}),vt=[],pt={props:{card:{type:Object},selected:{type:Boolean},up:{type:Boolean}},computed:{cssStyle:function(){return this.selected?{background:this.card._group?this.card._group.color:"#AAAAAA"}:{"border-color":this.card._group?this.card._group.color:"#AAAAAA"}}}},ft=pt,gt=(a("9ef2"),Object(g["a"])(ft,dt,vt,!1,null,null,null)),mt=gt.exports,ht=a("2516"),bt={components:{card:mt,"invalid-message":h},data:function(){var t=this,e={currentPool:null,targetPool:null,cardSelectType:"normal",inCardToggleStatus:!1,validator:new B,validation:{id:{rules:{required:{},without:{value:function(){return t.pools.map((function(t){return t.id})).filter((function(t){return t!=e.currentPool.id}))},message:"該id已被占用"}}},name:{rules:{required:{}}}}};return e.validator.bind((function(){return e.currentPool}),e.validation),e},computed:Object(r["a"])({cardGroups:function(){return this.$store.state.groups},cardList:function(){return this.$store.state.cards},groupsCards:function(){for(var t={},e=0;e<this.$store.state.cards.length;e++){var a=this.$store.state.cards[e],i=a.attributes.group;t[i]||(t[i]=[]),t[i].push(a)}return t}},Object(N["b"])(["pools"])),methods:{open:function(t){var e=new ht["a"](t.toModel());e.cardBox=t.cardBox,e.loadCardboxGroups(),this.currentPool=e,this.targetPool=t},create:function(){var t=new ht["a"];t.cardBox=this.$store.state.cardBox,t.loadCardboxGroups(),t.enableResidentCards(),this.currentPool=t,this.targetPool=null},commit:function(){if(this.validator.validate()){var t=this.currentPool.toModel();this.targetPool?this.targetPool.assign(t):this.pools.push(this.currentPool),this.currentPool=null,this.targetPool=null}},cancel:function(){this.currentPool=null,this.targetPool=null},remove:function(){this.$store.state.cardBox.removePool(this.currentPool),this.cancel()},toggleCard:function(t,e){if(this.inCardToggleStatus){var a=e.cards.findIndex((function(e){return e==t}));if("normal"==this.cardSelectType)if(a>=0){e.cards.splice(a,1);var i=e.upCards.findIndex((function(e){return e==t}));i>=0&&e.upCards.splice(i,1)}else e.cards.push(t);else if("up"==this.cardSelectType){var s=e.upCards.findIndex((function(e){return e==t}));s>=0?e.upCards.splice(s,1):e.upCards.push(t)}}},startToggleCard:function(t,e){this.inCardToggleStatus=!0,this.toggleCard(t,e)},stopToggleCard:function(){this.inCardToggleStatus=!1},toggleUpSelectMode:function(){this.cardSelectType="up"==this.cardSelectType?"normal":"up"},toggleAllCardInGroup:function(t,e){if(t&&Array.isArray(t.cards))if(e){var a=this.$store.state.cardBox.cards.filter((function(e){return e.group==t.groupId})).map((function(t){return t.id}));a.forEach((function(e){return t.cards.push(e)}))}else t.cards.splice(0,t.cards.length)},getCardsOfGroup:function(t){var e={};return t._cardsInBox.forEach((function(t){e[t.id]={name:t.name,selected:!1,up:!1,isDeprecated:!1,_group:t._group}})),t.cards.forEach((function(a){if(e[a]?e[a].selected=!0:e[a]={name:"("+a+")",isDeprecated:!0,_group:t._groupInfo},Array.isArray(t.upCards)&&t.upCards.length>0){var i=t.upCards.find((function(t){return t==a}));i&&(e[a].up=!0)}})),e}},filters:{isCardSelected:function(t,e){var a=e.cards.findIndex((function(e){return e==t.id}));return a>=0}},watch:{},mounted:function(){},created:function(){window.addEventListener("mouseup",this.stopToggleCard)},destroyed:function(){window.removeEventListener("mouseup",this.stopToggleCard)}},Ct=bt,wt=(a("99c4"),Object(g["a"])(Ct,lt,ut,!1,null,null,null)),yt=wt.exports,_t={components:{"card-box":Q,"card-group":ct,"card-pool":yt},data:function(){return{cardList:[]}},computed:Object(r["a"])({},Object(N["d"])(["cards"])),methods:Object(r["a"])({saveGame:function(){this.$store.dispatch("saveGame")},loadGame:function(t){var e={id:this.$store.state.currentGame.id,loadCustom:1==t};this.$store.dispatch("loadGame",e)}},Object(N["c"])(["saveConfig","loadConfig","loadDefaultConfig"])),mounted:function(){}},xt=_t,Ot=Object(g["a"])(xt,i,s,!1,null,null,null);e["default"]=Ot.exports},"0dfb":function(t,e,a){},1011:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cardpool"},[a("div",{staticClass:"stage"},t._l(t.stage,(function(t,e){return a("gamecard",{key:e,attrs:{value:t}})})),1),a("div",{staticClass:"panel"},[a("div",{staticClass:"panel-body"},[t.pool?a("div",{staticClass:"poolname"},[t._v(t._s(t.pool.name))]):t._e(),a("button",{staticClass:"btn",on:{click:function(e){return t.draw(1)}}},[t._v("單抽")]),a("button",{staticClass:"btn",on:{click:function(e){return t.draw(10)}}},[t._v("十連抽")]),a("button",{staticClass:"btn",on:{click:function(e){return t.draw(100)}}},[t._v("百連抽")]),a("button",{staticClass:"btn",on:{click:t.clear}},[t._v("清除")]),a("button",{staticClass:"btn",on:{click:t.showInfo}},[t._v("卡池資訊")]),a("button",{staticClass:"btn",on:{click:t.toPoolList}},[t._v("回列表")])])]),a("div",{staticClass:"panel"},[a("div",{staticClass:"panel-body"},t._l(t.statistic(),(function(e){return a("div",{key:e.attributes.id,staticClass:"statistic-group"},[a("label",{staticClass:"name",style:{"background-color":e.attributes.color}},[t._v(t._s(e.attributes.name))]),a("span",{staticClass:"count"},[t._v(t._s(e.count))])])})),0)]),a("div",{staticClass:"panel"},[a("div",{staticClass:"panel-header"},[t._v("歷史紀錄")]),a("div",{staticClass:"panel-body history"},t._l(t.orderedHistory(),(function(e,i){return a("div",{key:i,staticClass:"clustered-history"},[a("gamecard",{attrs:{value:e.card}}),a("div",{staticClass:"card-count"},[t._v("X"+t._s(e.count))])],1)})),0)]),a("poolinfo",{staticClass:"w-100 w-lg-75",attrs:{pool:t.pool},model:{value:t.infoDialog,callback:function(e){t.infoDialog=e},expression:"infoDialog"}})],1)},s=[],r=(a("7db0"),a("4160"),a("a434"),a("159b"),a("2a43")),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.value?a("div",{staticClass:"dialog poolinfo w-80"},[a("div",{staticClass:"dialog-header"},[t._v(" 卡池內容 "),a("span",{staticClass:"dismiss",on:{click:t.dismiss}},[t._v("X")])]),a("div",{staticClass:"dialog-body"},t._l(t.poolGroups,(function(e,i){return a("div",{key:i,staticClass:"group-row"},[a("div",{staticClass:"group-name",style:t.getHeaderStyle(e)},[a("span",{staticClass:"title"},[t._v(t._s(e.name))]),a("span",{staticClass:"subtitle"},[t._v(" | 概率："+t._s(e.rate))]),e.upRate>0?a("span",{staticClass:"subtitle"},[t._v("( 其中UP概率："+t._s(e.upRate)+" )")]):t._e()]),a("div",{staticClass:"group-cards"},t._l(t.getCards(e),(function(i,s){return a("gamecard",{key:s,class:t.getCardCssClass(e,i),attrs:{value:i}})})),1)])})),0)]):t._e()},o=[],c=(a("4de4"),a("c740"),a("d81d"),{props:{value:{type:Boolean},pool:{type:Object}},components:{gamecard:r["a"]},data:function(){return{}},computed:{poolGroups:function(){var t=this.pool.cardBox;return this.pool.groups.map((function(e){return e.model=t.groups.find((function(t){return t.id==e.groupId})),e}))}},methods:{dismiss:function(){this.$emit("input",!1)},getCards:function(t){var e=t.cards,a=this.pool.cardBox.cards.filter((function(t){return e.findIndex((function(e){return t.id==e}))>=0}));return a},getCardCssClass:function(t,e){var a={};if(Array.isArray(t.cards)){var i=t.upCards.find((function(t){return t==e.id}));i&&(a["gamecard-up"]=!0)}return a},getHeaderStyle:function(t){return{"border-bottom":"2px solid"+t.model.color}}}}),l=c,u=(a("817f"),a("2877")),d=Object(u["a"])(l,n,o,!1,null,null,null),v=d.exports,p={components:{gamecard:r["a"],poolinfo:v},data:function(){return{stage:[],history:{},drawnCardCount:0,pool:null,cardBox:null,infoDialog:!1}},methods:{draw:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.stage.splice(0,this.stage.length),this.pool.removeInvalidCards();for(var e=0;e<t;e++){var a=this.pool.choose();if(!a){alert("該池沒有可以抽取的卡片");break}var i=this.pool.cardBox.getCard(a);i?(this.stage.push(i),this.drawnCardCount++):console.error("An invalid card appear, this card will be discarded")}this.pushHistory(this.stage)},clear:function(){this.stage.splice(0,this.stage.length),this.history={}},showInfo:function(){this.infoDialog=!0},toPoolList:function(){this.$router.push({name:"poolIndex",params:this.$store.state.currentGame})},pushHistory:function(t){for(var e=this.history,a=0;a<t.length;a++){var i=t[a];e[i.id]?e[i.id].count+=1:e[i.id]={count:1,card:i}}return e},statistic:function(){var t={};for(var e in this.$store.getters.cardGroups.forEach((function(e){t[e.id]={attributes:e,count:0}})),this.history){var a=this.history[e].card._group;console.log(1),t[a.id]&&(t[a.id].count+=this.history[e].count)}return t},orderedHistory:function(){var t=[];for(var e in this.history){var a=this.history[e];t.push(a)}return t.sort((function(t,e){return t.count-e.count})),t}},computed:{},mounted:function(){var t=this.$route.params.id,e=this.$store.getters.pools.find((function(e){return e.id==t}));if(e)return this.pool=e;this.$router.push({name:"Home"})}},f=p,g=(a("072e"),Object(u["a"])(f,i,s,!1,null,null,null));e["default"]=g.exports},"1a63":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page"},[a("div",{staticClass:"page-title"},[t._v(t._s(t.currentGameName))]),a("menu-panel",{staticClass:"w-100 w-lg-50",attrs:{items:t.pools,title:"卡池"},on:{select:t.enterPool}}),a("div",[a("button",{staticClass:"btn",on:{click:t.toConfigPage}},[t._v("設定")])])],1)},s=[],r=(a("b0c0"),a("5530")),n=a("c179"),o=a("2f62"),c={data:function(){return{}},methods:{enterPool:function(t){this.$router.push({name:"pool",params:{id:t.id}})},toConfigPage:function(){this.$router.push({name:"poolConfig",params:this.$store.state.currentGame})}},computed:Object(r["a"])({currentGameName:function(){var t=this.$store.state.currentGame;return t?t.name:"-"}},Object(o["b"])(["pools"])),components:{"menu-panel":n["a"]}},l=c,u=a("2877"),d=Object(u["a"])(l,i,s,!1,null,null,null);e["default"]=d.exports},2325:function(t,e,a){},"2a43":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.styleClass,style:t.backgroundStyle},[t.value.image?a("div",{staticClass:"img-wrapper"},[a("img",{staticClass:"img",attrs:{src:t.value.image,alt:t.value.name}})]):t._e(),a("div",{staticClass:"gamecard-title"},[t._v(t._s(t.value.name))])])},s=[],r={props:{value:{type:Object},type:{type:String}},computed:{backgroundStyle:function(){return{background:this.value._group?this.value._group.color:"#AAAAAA"}},styleClass:function(){switch(this.type){case"min":return"gamecard-min";default:return"gamecard"}}}},n=r,o=(a("95f1"),a("2877")),c=Object(o["a"])(n,i,s,!1,null,null,null);e["a"]=c.exports},3920:function(t,e,a){"use strict";var i=a("ab91"),s=a.n(i);s.a},"44e7":function(t,e,a){var i=a("861d"),s=a("c6b6"),r=a("b622"),n=r("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[n])?!!e:"RegExp"==s(t))}},"4d63":function(t,e,a){var i=a("83ab"),s=a("da84"),r=a("94ca"),n=a("7156"),o=a("9bf2").f,c=a("241c").f,l=a("44e7"),u=a("ad6d"),d=a("9f7f"),v=a("6eeb"),p=a("d039"),f=a("69f3").set,g=a("2626"),m=a("b622"),h=m("match"),b=s.RegExp,C=b.prototype,w=/a/g,y=/a/g,_=new b(w)!==w,x=d.UNSUPPORTED_Y,O=i&&r("RegExp",!_||x||p((function(){return y[h]=!1,b(w)!=w||b(y)==y||"/a/i"!=b(w,"i")})));if(O){var k=function(t,e){var a,i=this instanceof k,s=l(t),r=void 0===e;if(!i&&s&&t.constructor===k&&r)return t;_?s&&!r&&(t=t.source):t instanceof k&&(r&&(e=u.call(t)),t=t.source),x&&(a=!!e&&e.indexOf("y")>-1,a&&(e=e.replace(/y/g,"")));var o=n(_?new b(t,e):b(t,e),i?this:C,k);return x&&a&&f(o,{sticky:a}),o},j=function(t){t in k||o(k,t,{configurable:!0,get:function(){return b[t]},set:function(e){b[t]=e}})},$=c(b),P=0;while($.length>P)j($[P++]);C.constructor=k,k.prototype=C,v(s,"RegExp",k)}g("RegExp")},"511e":function(t,e,a){},5530:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("a4d3"),a("4de4"),a("4160"),a("e439"),a("dbb4"),a("b64b"),a("159b");var i=a("ade3");function s(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?s(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}},"6b53":function(t,e,a){},"6d5c":function(t,e,a){"use strict";var i=a("cdd1"),s=a.n(i);s.a},"6d83":function(t,e,a){},"6f95":function(t,e,a){},"817f":function(t,e,a){"use strict";var i=a("e5a6"),s=a.n(i);s.a},"91b5":function(t,e,a){},"95f1":function(t,e,a){"use strict";var i=a("511e"),s=a.n(i);s.a},"99c4":function(t,e,a){"use strict";var i=a("91b5"),s=a.n(i);s.a},"9ef2":function(t,e,a){"use strict";var i=a("6f95"),s=a.n(i);s.a},ab91:function(t,e,a){},ade3:function(t,e,a){"use strict";function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}a.d(e,"a",(function(){return i}))},b64b:function(t,e,a){var i=a("23e7"),s=a("7b0b"),r=a("df75"),n=a("d039"),o=n((function(){r(1)}));i({target:"Object",stat:!0,forced:o},{keys:function(t){return r(s(t))}})},c67e:function(t,e,a){"use strict";var i=a("2325"),s=a.n(i);s.a},cdd1:function(t,e,a){},d9de:function(t,e,a){},daaa:function(t,e,a){"use strict";var i=a("6b53"),s=a.n(i);s.a},dbb4:function(t,e,a){var i=a("23e7"),s=a("83ab"),r=a("56ef"),n=a("fc6a"),o=a("06cf"),c=a("8418");i({target:"Object",stat:!0,sham:!s},{getOwnPropertyDescriptors:function(t){var e,a,i=n(t),s=o.f,l=r(i),u={},d=0;while(l.length>d)a=s(i,e=l[d++]),void 0!==a&&c(u,e,a);return u}})},e439:function(t,e,a){var i=a("23e7"),s=a("d039"),r=a("fc6a"),n=a("06cf").f,o=a("83ab"),c=s((function(){n(1)})),l=!o||c;i({target:"Object",stat:!0,forced:l,sham:!o},{getOwnPropertyDescriptor:function(t,e){return n(r(t),e)}})},e5a6:function(t,e,a){},f81e:function(t,e,a){"use strict";var i=a("0dfb"),s=a.n(i);s.a},fb84:function(t,e,a){"use strict";var i=a("6d83"),s=a.n(i);s.a}}]);
//# sourceMappingURL=pool.c3bb3a0c.js.map